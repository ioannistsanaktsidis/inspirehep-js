/*
 * This file is part of INSPIRE.
 * Copyright (C) 2016 CERN.
 *
 * INSPIRE is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as
 * published by the Free Software Foundation; either version 2 of the
 * License, or (at your option) any later version.
 *
 * INSPIRE is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with INSPIRE; if not, write to the Free Software Foundation, Inc.,
 * 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
 *
 * In applying this license, CERN does not
 * waive the privileges and immunities granted to it by virtue of its status
 * as an Intergovernmental Organization or submit itself to any jurisdiction.
 */
!function(t){t.module("inspirehep",["citemodal","export","checkbox"])}(angular),function(t){t.module("checkbox",["checkbox.controllers","checkbox.services"])}(angular),function(t){t.module("citemodal",["ngclipboard","ui.bootstrap","citemodal.directives","citemodal.services","citemodal.controllers"]),t.module("citemodal").config(["$uibTooltipProvider",function(t){t.setTriggers({click:"mouseleave"})}])}(angular),function(t){t.module("export",["ngclipboard","ngSanitize","ui.bootstrap","export.directives","export.controllers"]),t.module("export").config(["$uibTooltipProvider",function(t){t.setTriggers({click:"mouseleave"})}])}(angular),function(t){function e(e,o){function n(t){o.toggleIdToExport(t),e.$parent.vm.enable_cite_button=o.getIdsToExport().length>0}function r(t){return-1!==o.getIdsToExport().indexOf(t)}function a(){return i()}function c(){var n=i();t.forEach(e.$parent.vm.invenioSearchResults.hits.hits,function(t){n?o.removeIdFromExport(t.id):o.addIdToExport(t.id)}),e.$parent.vm.enable_cite_button=o.getIdsToExport().length>0}function i(){try{return e.$parent.vm.invenioSearchResults.hits.hits.length===o.getIdsToExport().length}catch(t){return!1}}e.loadIdsToExport=n,e.getAllIdsToExport=c,e.$parent.vm.enable_cite_button=!1,e.isChecked=r,e.allChecked=a}e.$inject=["$scope","exportRecords"],t.module("checkbox.controllers",[]).controller("checkboxCtrl",e)}(angular),function(t){function e(){function t(t){return i.indexOf(t)}function e(t,e){-1===t&&i.push(e)}function o(t){t>-1&&i.splice(t,1)}function n(o){var n=t(o);e(n,o)}function r(e){var n=t(e);o(n,e)}function a(n){var r=t(n);r>-1?o(r,n):e(r,n)}function c(){return i}var i=[],l={addIdToExport:n,removeIdFromExport:r,toggleIdToExport:a,getIdsToExport:c};return l}t.module("checkbox.services",[]).service("exportRecords",e)}(angular),function(t){function e(e,o,n,r){function a(){p.loadFormat()}function c(){o.close()}function i(t){p.exportFormat=t}function l(){var e=(new Blob([p.exportContent],{type:"text/plain"}),"text/plain;charset=utf-8,"+encodeURIComponent(p.exportContent)),o=t.element('<a id="data-download" href="data:'+e+'" download="'+p.exportFormat+"."+p.formats[p.exportFormat]+'">download</a>');o[0].click()}function u(t,e){t!==e&&p.loadFormat()}function d(){function t(t){p.exportContent=t.data}function e(){console.log("Error request")}function o(){p.loading=!1}p.loading=!0,n.getFormat(p.exportFormat,p.recid).then(t,e).finally(o)}var p=this;p.formats={BibTex:"bib","LaTex(EU)":"tex","LaTex(US)":"tex","CV format (LaTex)":"tex","CV format (html)":"html","CV format (text)":"txt"},p.recid=r,p.exportContent=null,p.loading=!1,p.exportFormat="BibTex",p.changeFormat=i,p.closeModal=c,p.loadFormat=d,p.downloadFormat=l,a(),e.$watch("vm.exportFormat",u)}e.$inject=["$scope","$uibModalInstance","exportAPI","recid"],t.module("citemodal.controllers",[]).controller("modalInstanceCtrl",e)}(angular),function(t){function e(t){function e(e,o,n){e.openModal=function(e){t.open({animation:!0,templateUrl:n.bodyTemplate,size:e,controller:"modalInstanceCtrl",controllerAs:"vm",resolve:{recid:function(){return n.recid}}})}}function o(t,e){return e.buttonTemplate}return{templateUrl:o,restrict:"E",scope:!1,link:e}}e.$inject=["$uibModal"],t.module("citemodal.directives",[]).directive("inspireCiteModal",e)}(angular),function(t){function e(e){function o(o,n){var r={},a="";if(n instanceof Array){var c=[];a="/api/literature/?size=25&q=",t.forEach(n,function(t){c.push("control_number:"+t)}),a+=c.join("+OR+")}else a="/api/literature/"+n;switch(o){case"BibTex":r.headers={Accept:"application/x-bibtex"};break;case"LaTex(EU)":r.headers={Accept:"application/x-latexeu"};break;case"LaTex(US)":r.headers={Accept:"application/x-latexus"};break;case"CV format (LaTex)":r.headers={Accept:"application/x-cvformatlatex"};break;case"CV format (html)":r.headers={Accept:"application/x-cvformathtml"};break;case"CV format (text)":r.headers={Accept:"application/x-cvformattext"}}return e.get(a,r)}var n={getFormat:o};return n}e.$inject=["$http"],t.module("citemodal.services",[]).service("exportAPI",e)}(angular),function(t){function e(e,o,n,r){function a(){p.loadFormat()}function c(){o.close()}function i(t){p.exportAllContent="",p.exportFormat=t}function l(){var e=(new Blob([p.exportAllContent],{type:"text/plain"}),"text/plain;charset=utf-8,"+encodeURIComponent(p.exportAllContent)),o=t.element('<a id="data-download" href="data:'+e+'" download="'+p.exportFormat+"."+p.formats[p.exportFormat]+'">download</a>');o[0].click()}function u(t,e){t!==e&&p.loadFormat()}function d(){function t(t){p.exportAllContent=t.data}function e(){console.log("Error request")}function o(){p.loading=!1}p.loading=!0,p.recidsToExport=r.getIdsToExport(),n.getFormat(p.exportFormat,p.recidsToExport).then(t,e).finally(o)}var p=this;p.formats={BibTex:"bib","LaTex(EU)":"tex","LaTex(US)":"tex","CV format (LaTex)":"tex","CV format (html)":"html","CV format (text)":"txt"},p.recidsToExport=[],p.exportAllContent=null,p.loading=!1,p.exportFormat="BibTex",p.changeFormat=i,p.closeModal=c,p.loadFormat=d,p.downloadFormat=l,a(),e.$watch("vm.exportFormat",u)}e.$inject=["$scope","$uibModalInstance","exportAPI","exportRecords"],t.module("export.controllers",[]).controller("exportModalInstanceCtrl",e)}(angular),function(t){function e(t){function e(e,o,n){e.openModal=function(o){if(e.vm.enable_cite_button){t.open({animation:!0,templateUrl:n.bodyTemplate,size:o,controller:"exportModalInstanceCtrl",controllerAs:"vm",resolve:{recid:function(){return n.recid}}})}}}function o(t,e){return e.buttonTemplate}return{templateUrl:o,restrict:"E",scope:!1,link:e}}e.$inject=["$uibModal"],t.module("export.directives",[]).directive("inspireExportModal",e)}(angular);